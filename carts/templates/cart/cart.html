{%extends 'base.html'%}
{%block content%}
<main class="main">
    <div class="container-fluid">
        <div class="row my-5">
            <div class="col-lg-8">
                <h1>Your Cart</h1>
                <div class="d-flex justify-content-between">
                    <h6>There are <span>{{cart_items.count}}</span> products in your cart</h6>
                    <!-- <h6> <a href="" class="text-muted"> <i class="fas fa-trash"></i>Clear Cart</a></h6> -->
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th class="text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {%for cart_item in cart_items%}
                        <tr>
                            <td>
                                <div class="d-md-flex  me-lg-5">
                                    <div class="aside d-none d-md-block">
                                        <img src="{{cart_item.product.image.url}}" width="70px"
                                            class="img-sm border rounded">
                                    </div>
                                    <div class="info ml-md-4"> <a href="{{cart_item.product.get_product_url}}" class="title mb-1"> {{cart_item.product.product_name}}</a>
                                        <p class="text-muted small"> 
                                            {%if cart_item.variations.all%}
                                            {%for item in cart_item.variations.all %}
                                            <strong>{{item.variation_category|capfirst}}</strong> : <strong>
                                                {{item.variation_value|capfirst}}</strong><br>
                                            {%endfor%}
                                            {%endif%}
                                        </p>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="input-group input-spinner mb-3">
                                    <a href="{%url 'remove_cart' cart_item.product.id cart_item.id%}"
                                        class="btn btn-icon btn-outline-success" style="padding: 0.625rem 0.25rem;"
                                        type="button"> <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"
                                            fill="#999" viewBox="0 0 24 24">
                                            <path d="M19 13H5v-2h14v2z"></path>
                                        </svg>
                                    </a>
                                    <input class="form-control text-center" placeholder=""
                                        value="{{cart_item.quantity}}" style="width: 40px;">

                                    <form action="{% url 'add_cart' cart_item.product.id %}" method="POST">
                                        {%csrf_token%}
                                        {%for item in cart_item.variations.all %}
                                        <input type="hidden" name="{{item.variation_category | lower}}"
                                            value="{{item.variation_value | capfirst}}">
                                        {%endfor%}
                                        <button type="submit" class="btn btn-icon btn-outline-success" style="padding: 0.625rem 0.25rem;"
                                            type="button"> <svg xmlns="http://www.w3.org/2000/svg" width="22"
                                                height="22" fill="#999" viewBox="0 0 24 24">
                                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path>
                                            </svg>
                                        </button>
                                    </form>
                                </div>
                            </td>
                            <td class="pr-0">
                                <span class="h5 pb-0">GH¢{{cart_item.subtotal}}.00</span>
                                <br>
                                <small class="text-muted">GH¢{{cart_item.product.price}} each </small>
                            </td>
                            <td class="td-actions text-right">
                                <a href="{%url 'remove_cart_item' cart_item.product.id cart_item.id %}" rel="tooltip" class="btn btn-danger btn-icon btn-sm "
                                    data-original-title="" title="delete" 
                                    onclick="return confirm('Are you sure you want to delete this item?')">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </td>
                        </tr>
                        {%endfor%}

                    </tbody>
                </table>
            </div>
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-body">
                        <dl class="dlist-align">
                            <dt>Total price:</dt>
                            <dd class="text-end"> GH¢{{total}}.00</dd>
                        </dl>
                        <!-- <dl class="dlist-align">
                            <dt>Discount:</dt>
                            <dd class="text-end text-success"> -GH¢60.00 </dd>
                        </dl> -->
                        {% comment %} <dl class="dlist-align">
                            <dt>TAX:</dt>
                            <dd class="text-end text-danger">+GH¢{{tax}} </dd>
                        </dl> {% endcomment %}
                        <hr>
                        <dl class="dlist-align">
                            <dt>Total:</dt>
                            <dd class="text-end text-dark h5">GH¢{{grand_total}} </dd>
                        </dl>
                        <div class="d-grid gap-2 my-3">
                            <a href="{%url 'checkout'%}" class="btn btn-success w-100 my-4"> Confirm Purchase</a>
                            <a href="{%url 'store'%}" class="btn btn-outline-info w-100"> Back to shop </a>
                        </div>
                    </div> <!-- card-body.// -->
                </div>
            </div>
        </div>
    </div>
</main>

{%endblock%}